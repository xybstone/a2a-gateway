name: Notify on Push to Slack

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
      - '**.txt'
      - 'docs/**'
      - '.gitignore'
      - '.gitattributes'

jobs:
  notify-slack:
    name: Send notification to Slack
    runs-on: ubuntu-latest
    steps:
      - name: Send Slack notification
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_CHANNEL: "#all-forai"
        run: |
          # å‡†å¤‡æ¶ˆæ¯å†…å®¹
          COMMIT_AUTHOR="${{ github.actor }}"
          COMMIT_SHA="${{ github.sha }}"
          COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
          COMMIT_URL="${{ github.event.head_commit.url }}"
          BRANCH="${{ github.ref_name }}"
          
          # è·å–å˜æ›´çš„æ–‡ä»¶ï¼ˆæœ€å¤š 10 ä¸ªï¼‰
          CHANGED_FILES=$(git diff --name-only HEAD~1 HEAD | head -10 | tr '\n' ',' | sed 's/,$//')
          
          # æ ¼å¼åŒ–æ—¶é—´
          TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
          
          # å‘é€ Slack æ¶ˆæ¯
          curl -X POST "${SLACK_WEBHOOK_URL}" \
            -H 'Content-Type: application/json' \
            --data "{
              \"text\": \"ğŸ“¬ New commit to a2a-gateway\\n\\nğŸ‘¤ Author: ${COMMIT_AUTHOR}\\nğŸ”— Branch: ${BRANCH}\\nğŸ“ Commit: ${COMMIT_MESSAGE:0:100}${COMMIT_MESSAGE: +1:}...\\nğŸ”— URL: ${COMMIT_URL}\\nğŸ• Time: ${TIMESTAMP}\\nğŸ“ Changed files: ${CHANGED_FILES}\\n\\nğŸ¤– ä¸‰å¼Ÿæ­£åœ¨åˆ†æè¿™æ¬¡æäº¤...\"
            }"
          
          echo "Slack notification sent successfully"
